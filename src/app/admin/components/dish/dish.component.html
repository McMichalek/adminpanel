<div class="dish-container">
  <h2>Panel dań (Dish)</h2>

  <!-- Formularz: Tworzenie lub Edycja -->
  <div class="form-card mb-4">
    <h4>{{ isEditMode ? 'Edytuj danie' : 'Dodaj nowe danie' }}</h4>
    <form (ngSubmit)="onSubmit()" #dishForm="ngForm">
      <!-- Pola tylko w trybie tworzenia -->
      <div *ngIf="!isEditMode" class="row g-3">
        <div class="col-md-6">
          <label for="nameInput" class="form-label">Nazwa:</label>
          <input
            type="text"
            id="nameInput"
            name="name"
            class="form-control"
            required
            [(ngModel)]="createForm.name"
          />
        </div>
        <div class="col-md-6">
          <label for="categoryInput" class="form-label">Kategoria:</label>
          <input
            type="text"
            id="categoryInput"
            name="category"
            class="form-control"
            [(ngModel)]="createForm.category"
          />
        </div>
        <div class="col-12">
          <label for="descriptionInput" class="form-label">Opis:</label>
          <textarea
            id="descriptionInput"
            name="description"
            class="form-control"
            rows="2"
            required
            [(ngModel)]="createForm.description"
          ></textarea>
        </div>
        <div class="col-md-4">
          <label for="priceInput" class="form-label">Cena:</label>
          <input
            type="number"
            id="priceInput"
            name="price"
            class="form-control"
            required
            min="0"
            step="0.01"
            [(ngModel)]="createForm.price"
          />
        </div>
      </div>

      <div *ngIf="isEditMode" class="row g-3">
        <div class="col-md-6">
          <label for="editName" class="form-label">Nazwa:</label>
          <input
            type="text"
            id="editName"
            name="name"
            class="form-control"
            required
            [(ngModel)]="updateForm.name"
          />
        </div>
        <div class="col-md-6">
          <label for="editCategory" class="form-label">Kategoria:</label>
          <input
            type="text"
            id="editCategory"
            name="category"
            class="form-control"
            [(ngModel)]="updateForm.category"
          />
        </div>
        <div class="col-12">
          <label for="editDescription" class="form-label">Opis:</label>
          <textarea
            id="editDescription"
            name="description"
            class="form-control"
            rows="2"
            required
            [(ngModel)]="updateForm.description"
          ></textarea>
        </div>
        <div class="col-md-4">
          <label for="editPrice" class="form-label">Cena:</label>
          <input
            type="number"
            id="editPrice"
            name="price"
            class="form-control"
            required
            min="0"
            step="0.01"
            [(ngModel)]="updateForm.price"
          />
        </div>
      </div>

      <div class="mt-3">
        <button
          type="submit"
          class="btn btn-primary me-2"
          [disabled]="dishForm.invalid"
        >
          {{ isEditMode ? 'Zapisz zmiany' : 'Dodaj danie' }}
        </button>
        <button
          *ngIf="isEditMode"
          type="button"
          class="btn btn-secondary"
          (click)="cancelEdit()"
        >
          Anuluj edycję
        </button>
      </div>
    </form>
  </div>

  <!-- Komunikaty o błędzie / ładowaniu -->
  <div *ngIf="loading" class="alert alert-info">Ładowanie...</div>
  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

  <!-- Tabela: Lista wszystkich dań -->
  <div class="table-card">
    <h4>Lista dań</h4>
    <table
      *ngIf="!loading && dishes.length > 0"
      class="table table-striped table-hover mt-3"
    >
      <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>Nazwa</th>
        <th>Kategoria</th>
        <th>Opis</th>
        <th>Cena</th>
        <th>Akcje</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let d of dishes">
        <td>{{ d.id }}</td>
        <td>{{ d.name }}</td>
        <td>{{ d.category || '—' }}</td>
        <td>{{ d.description }}</td>
        <td>{{ d.price | number: '1.2-2' }}</td>
        <td>
          <button
            class="btn btn-sm btn-warning me-2"
            (click)="startEdit(d)"
          >
            Edytuj
          </button>
          <button
            class="btn btn-sm btn-danger"
            (click)="onDelete(d.id)"
          >
            Usuń
          </button>
        </td>
      </tr>
      </tbody>
    </table>
    <div *ngIf="!loading && dishes.length === 0">
      <p>Brak dań w bazie danych.</p>
    </div>
  </div>
</div>
